!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AsteroidOauthMixin=t():e.AsteroidOauthMixin=t()}(this,function(){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=e.endpoint,o=e.platform;this.subscribe("meteor.loginServiceConfiguration"),this.oauth={platform:o,url:(0,l.default)(t)}}function i(e){d[e.name]=e}function a(e,t,o,r){var n=this,s=d[e].getOptions({url:this.oauth.url,configCollection:this.getServiceConfig(e),scope:t,offlineAccess:o,forcePrompt:r});return(0,p.default)(this.oauth.platform,this.oauth.url.host,s.credentialToken,s.loginUrl,function(e){return n.login({oauth:e})})}Object.defineProperty(t,"__esModule",{value:!0}),t.init=s,t.registerOauthProvider=i,t.loginWith=a;var u=o(1),l=n(u),c=o(4),p=n(c),f=o(6),h=r(f),d={google:h}},function(e,t,o){(function(t){"use strict";function r(e){e=e||t.location||{};var o,r={},n=typeof e;if("blob:"===e.protocol)r=new i(unescape(e.pathname),{});else if("string"===n){r=new i(e,{});for(o in d)delete r[o]}else if("object"===n){for(o in e)o in d||(r[o]=e[o]);void 0===r.slashes&&(r.slashes=f.test(e.href))}return r}function n(e){var t=p.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function s(e,t){for(var o=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=o.length,n=o[r-1],s=!1,i=0;r--;)"."===o[r]?o.splice(r,1):".."===o[r]?(o.splice(r,1),i++):i&&(0===r&&(s=!0),o.splice(r,1),i--);return s&&o.unshift(""),"."!==n&&".."!==n||o.push(""),o.join("/")}function i(e,t,o){if(!(this instanceof i))return new i(e,t,o);var a,u,p,f,d,v,g=h.slice(),m=typeof t,y=this,_=0;for("object"!==m&&"string"!==m&&(o=t,t=null),o&&"function"!=typeof o&&(o=c.parse),t=r(t),u=n(e||""),a=!u.protocol&&!u.slashes,y.slashes=u.slashes||a&&t.slashes,y.protocol=u.protocol||t.protocol||"",e=u.rest,u.slashes||(g[2]=[/(.*)/,"pathname"]);_<g.length;_++)f=g[_],p=f[0],v=f[1],p!==p?y[v]=e:"string"==typeof p?~(d=e.indexOf(p))&&("number"==typeof f[2]?(y[v]=e.slice(0,d),e=e.slice(d+f[2])):(y[v]=e.slice(d),e=e.slice(0,d))):(d=p.exec(e))&&(y[v]=d[1],e=e.slice(0,d.index)),y[v]=y[v]||(a&&f[3]?t[v]||"":""),f[4]&&(y[v]=y[v].toLowerCase());o&&(y.query=o(y.query)),a&&t.slashes&&"/"!==y.pathname.charAt(0)&&(""!==y.pathname||""!==t.pathname)&&(y.pathname=s(y.pathname,t.pathname)),l(y.port,y.protocol)||(y.host=y.hostname,y.port=""),y.username=y.password="",y.auth&&(f=y.auth.split(":"),y.username=f[0]||"",y.password=f[1]||""),y.origin=y.protocol&&y.host&&"file:"!==y.protocol?y.protocol+"//"+y.host:"null",y.href=y.toString()}function a(e,t,o){var r=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(o||c.parse)(t)),r[e]=t;break;case"port":r[e]=t,l(t,r.protocol)?t&&(r.host=r.hostname+":"+t):(r.host=r.hostname,r[e]="");break;case"hostname":r[e]=t,r.port&&(t+=":"+r.port),r.host=t;break;case"host":r[e]=t,/:\d+$/.test(t)?(t=t.split(":"),r.port=t.pop(),r.hostname=t.join(":")):(r.hostname=t,r.port="");break;case"protocol":r.protocol=t.toLowerCase(),r.slashes=!o;break;case"pathname":r.pathname=t.length&&"/"!==t.charAt(0)?"/"+t:t;break;default:r[e]=t}for(var n=0;n<h.length;n++){var s=h[n];s[4]&&(r[s[1]]=r[s[1]].toLowerCase())}return r.origin=r.protocol&&r.host&&"file:"!==r.protocol?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function u(e){e&&"function"==typeof e||(e=c.stringify);var t,o=this,r=o.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var n=r+(o.slashes?"//":"");return o.username&&(n+=o.username,o.password&&(n+=":"+o.password),n+="@"),n+=o.host+o.pathname,t="object"==typeof o.query?e(o.query):o.query,t&&(n+="?"!==t.charAt(0)?"?"+t:t),o.hash&&(n+=o.hash),n}var l=o(2),c=o(3),p=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,f=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,h=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],d={hash:1,query:1};i.prototype={set:a,toString:u},i.extractProtocol=n,i.location=r,i.qs=c,e.exports=i}).call(t,function(){return this}())},function(e,t){"use strict";e.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},function(e,t){"use strict";function o(e){return decodeURIComponent(e.replace(/\+/g," "))}function r(e){for(var t,r=/([^=?&]+)=?([^&]*)/g,n={};t=r.exec(e);n[o(t[1])]=o(t[2]));return n}function n(e,t){t=t||"";var o=[];"string"!=typeof t&&(t="?");for(var r in e)s.call(e,r)&&o.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return o.length?t+o.join("&"):""}var s=Object.prototype.hasOwnProperty;t.stringify=n,t.parse=r},function(e,t,o){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t,o,r,n){var s=a[e],i=new s({host:t,credentialToken:o,loginUrl:r});return i.init().then(n)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var s=o(5),i=r(s),a={browser:i.default};e.exports=t.default},function(e,t,o){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),i=o(1),a=r(i),u=function(){function e(t){var o=this,r=t.credentialToken,s=t.host,i=t.loginUrl;n(this,e),this.credentialToken=r,this.host=s,this.loginUrl=i,this._credentialSecretPromise=new Promise(function(e,t){o._resolvePromise=e,o._rejectPromise=t})}return s(e,[{key:"_startPolling",value:function(){var e=this,t=JSON.stringify({credentialToken:this.credentialToken});this.intervalId=window.setInterval(function(){e.popup.postMessage(t,e.host)},100),window.addEventListener("message",this._onMessage.bind(this))}},{key:"_stopPolling",value:function(){window.clearInterval(this.intervalId)}},{key:"_onMessage",value:function(e){var t=e.data,o=e.origin;try{var r=JSON.parse(t);if((0,a.default)(o).host!==this.host)return;r.credentialToken===this.credentialToken&&this._resolvePromise({credentialToken:r.credentialToken,credentialSecret:r.credentialSecret}),r.error&&this._rejectPromise(r.error)}catch(e){}}},{key:"_openPopup",value:function(){this.popup=window.open(this.loginUrl,"_blank","location=no,toolbar=no"),this.popup.focus&&this.popup.focus()}},{key:"_closePopup",value:function(){this.popup.close()}},{key:"init",value:function(){var e=this;return this._openPopup(),this._startPolling(),this._credentialSecretPromise.then(function(t){return e._stopPolling(),e._closePopup(),t})}}]),e}();t.default=u,e.exports=t.default},function(e,t,o){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e){var t=e.url,o=e.configCollection,r=e.scope,n=e.offlineAccess,s=e.forcePrompt,a=(0,u.default)(),l=t.protocol,p=t.host,h={response_type:"code",client_id:(0,f.default)(o),redirect_uri:(0,d.default)(l)+("//"+p+"/_oauth/google"),state:(0,c.default)(a),scope:r||"openid email"};n&&(h.access_type="offline"),s&&(h.approval_prompt="force");var v=(0,i.default)("https://accounts.google.com/o/oauth2/auth").set("query",h).toString();return{credentialToken:a,loginUrl:v}}Object.defineProperty(t,"__esModule",{value:!0}),t.getOptions=n;var s=o(1),i=r(s),a=o(7),u=r(a),l=o(8),c=r(l),p=o(9),f=r(p),h=o(10),d=r(h),v="google";t.name=v},function(e,t){"use strict";function o(){for(var e="",t=0;t<8;t++)e+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,e.exports=t.default},function(e,t){"use strict";function o(e){var t={loginStyle:"popup",credentialToken:e,isCordova:!1};return window.btoa(JSON.stringify(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,e.exports=t.default},function(e,t){"use strict";function o(e){return e.clientId||e.consumerKey||e.appId}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,e.exports=t.default},function(e,t){"use strict";function o(e){return"ws:"===e||"http:"===e?"http:":"wss:"===e||"https:"===e?"https:":void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,e.exports=t.default}])});